<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>Valentinsdate?</title>

  <style>
    :root{
      --ink:#1f1f1f;
      --pink:#ff3f86;
      --blue:#7aa7ff;
      --lime:#79ffb2;
      --card:#ffffffd6;
      --shadow: 0 18px 60px rgba(0,0,0,.14);
      --radius: 24px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(900px 650px at 20% 10%, #ffd1e6 0%, transparent 62%),
        radial-gradient(900px 650px at 90% 20%, #d6e4ff 0%, transparent 58%),
        radial-gradient(700px 500px at 50% 90%, #d7ffe8 0%, transparent 55%),
        linear-gradient(135deg, #fff0f6, #f3f0ff);
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
    }

    .grain{
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        repeating-linear-gradient(0deg, rgba(0,0,0,.018) 0px, rgba(0,0,0,.018) 1px, transparent 2px, transparent 4px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.014) 0px, rgba(0,0,0,.014) 1px, transparent 2px, transparent 5px);
      mix-blend-mode:multiply;
      opacity:.55;
      z-index: 1;
    }

    svg#filters{ position:absolute; width:0; height:0; }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:14px;
      position:relative;
      z-index: 2;
    }

    .card{
      width:min(960px, 96vw);
      background:var(--card);
      border-radius:var(--radius);
      border: 2px solid rgba(0,0,0,.70);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      backdrop-filter: none;
      filter: url(#wobble);
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-60px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,63,134,.18), transparent 55%),
        radial-gradient(circle at 80% 40%, rgba(122,167,255,.20), transparent 60%),
        radial-gradient(circle at 50% 90%, rgba(121,255,178,.16), transparent 55%);
      transform: rotate(-4deg);
      opacity:.9;
      pointer-events:none;
    }

    main{
      position:relative;
      z-index:1;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .topRow{
      display:grid;
      place-items:center;
      padding-top:4px;
    }
    .topGif{
      width: clamp(140px, 46vw, 220px);
      height:auto;
      border-radius:16px;
      border: 2px solid rgba(0,0,0,.65);
      box-shadow: 0 14px 28px rgba(0,0,0,.12);
      background:#fff;
      opacity:.96;
      transform: rotate(-1deg);
    }

    .panel{
      background:#fff;
      border: 2px solid rgba(0,0,0,.65);
      border-radius: calc(var(--radius) - 6px);
      padding:14px;
      box-shadow: 0 14px 32px rgba(0,0,0,.09);
      position:relative;
      overflow:hidden;
      transform: rotate(-.25deg);
    }
    .panel .scribble{
      position:absolute;
      inset:auto -40px -60px auto;
      width:220px;
      height:220px;
      border: 3px dashed rgba(255,63,134,.55);
      border-radius:40px;
      transform: rotate(18deg);
      opacity:.65;
      pointer-events:none;
    }

    h1{
      margin:8px 0 6px;
      font-size: clamp(24px, 6.4vw, 44px);
      line-height:1.05;
      letter-spacing:.2px;
    }
    .sub{
      margin:0 0 10px;
      opacity:.82;
      font-size: clamp(13px, 3.8vw, 17px);
    }
    .copy{
      font-size: 16px;
      line-height:1.5;
      margin:0;
    }
    .copy b{ color:var(--pink); }

    .btns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
      align-items:center;
      position:relative;
      min-height:58px;
    }

    button{
      border: 2px solid rgba(0,0,0,.75);
      border-radius:999px;
      padding:13px 16px;
      font-weight:1000;
      cursor:pointer;
      background:#fff;
      box-shadow: 0 12px 26px rgba(0,0,0,.12);
      transition: transform .12s ease, filter .12s ease, opacity .12s ease;
      transform: rotate(.5deg);
      user-select:none;
      touch-action: manipulation;
      flex: 1 1 140px;
      max-width: 220px;
    }
    button:hover{ transform: translateY(-2px) rotate(-.5deg); }
    button:active{ transform: translateY(0) rotate(.2deg) scale(.99); }

    .yes{
      background: linear-gradient(135deg, #ff3f86, #ff8bb0);
      color:#fff;
    }
    .maybe{
      background: linear-gradient(135deg, #fff3b0, #ffe08a);
      color:#222;
    }
    .no{
      background: linear-gradient(135deg, #e9eef7, #f7f7ff);
      color:#1f2a3a;
      position:relative;
      will-change: transform;
    }

    .no.runner{
      position:absolute;
      left: 210px;
      top: 0px;
      transform: rotate(-2deg);
      animation: runAway 3.6s ease-in forwards;
      pointer-events:none;
    }
    @keyframes runAway{
      0%   { transform: translate(0,0) rotate(-2deg); opacity:1; }
      60%  { transform: translate(340px, 22px) rotate(6deg); opacity:1; }
      100% { transform: translate(820px, 90px) rotate(14deg); opacity:0; }
    }

    .no .legs{
      display:none;
      position:absolute;
      left: 14px;
      bottom: -18px;
      width: 78px;
      height: 24px;
      pointer-events:none;
    }
    .no.runner .legs{ display:block; }
    .leg{
      position:absolute;
      width: 18px;
      height: 22px;
      border: 2px solid rgba(0,0,0,.78);
      border-top:0;
      border-radius: 0 0 12px 12px;
      background:#fff;
      bottom:0;
      animation: leg 260ms linear infinite;
      filter: url(#wobble);
    }
    .leg.l1{ left: 10px; transform-origin: top center; }
    .leg.l2{ left: 42px; transform-origin: top center; animation-delay:130ms; }
    @keyframes leg{
      0%,100%{ transform: rotate(18deg); }
      50%{ transform: rotate(-18deg); }
    }

    .result{
      margin-top:12px;
      display:none;
      padding:12px;
      border-radius:18px;
      border: 2px dashed rgba(0,0,0,.75);
      background: #fff9fc;
      transform: rotate(.2deg);
    }
    .result.show{ display:block; }
    .result h2{ margin:0 0 6px; font-size: 20px; }
    .result p{ margin:0; opacity:.86; }

    .choices{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .chipBtn{
      border: 2px solid rgba(0,0,0,.75);
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      font-weight:1000;
      cursor:pointer;
      box-shadow: 0 12px 26px rgba(0,0,0,.10);
      transform: rotate(.2deg);
    }
    .chipBtn:hover{ transform: translateY(-2px) rotate(-.6deg); }
    .chipBtn:active{ transform: translateY(0) rotate(.2deg) scale(.99); }

    .inputRow{
      margin-top:12px;
      display:none;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .inputRow.show{ display:flex; }
    input[type="text"]{
      flex: 1 1 220px;
      border: 2px solid rgba(0,0,0,.75);
      border-radius:16px;
      padding:12px 12px;
      font-weight:900;
      outline:none;
      box-shadow: 0 12px 26px rgba(0,0,0,.08);
      filter: url(#wobble);
    }
    .saveBtn{
      border-radius:16px;
      padding:12px 14px;
      font-weight:1000;
      border: 2px solid rgba(0,0,0,.75);
      background: #fff;
      cursor:pointer;
      flex: 0 0 auto;
      max-width:none;
    }

    .picked{
      margin-top:10px;
      display:none;
      padding:10px 12px;
      border-radius:16px;
      border: 2px solid rgba(0,0,0,.75);
      background:#f4fff9;
      font-weight:950;
      transform: rotate(-.2deg);
    }
    .picked.show{ display:block; }

    .stage{
      background:#fff;
      border: 2px solid rgba(0,0,0,.65);
      border-radius: calc(var(--radius) - 6px);
      padding:12px;
      box-shadow: 0 14px 32px rgba(0,0,0,.09);
      position:relative;
      overflow:hidden;
      transform: rotate(.25deg);
    }

    .faces{
      position:relative;
      display:grid;
      place-items:center;
      min-height:300px;
    }
    @media (max-width: 420px){
      .faces{ min-height:270px; }
    }

    .heartLink{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
      filter: drop-shadow(0 16px 22px rgba(255,63,134,.18));
      z-index:1;
      opacity:.9;
    }
    .heartSvg{
      width:min(520px, 92%);
      height:auto;
      opacity:.92;
      transform: rotate(-8deg);
    }
    .strokeA{
      fill:none;
      stroke: rgba(0,0,0,.82);
      stroke-width: 10;
      stroke-linecap:round;
      stroke-linejoin:round;
      stroke-dasharray: 1600;
      stroke-dashoffset: 1600;
      animation: draw 1.85s ease-in-out infinite;
    }
    .strokeB{
      fill:none;
      stroke: rgba(255,63,134,.95);
      stroke-width: 8;
      stroke-linecap:round;
      stroke-linejoin:round;
      stroke-dasharray: 1600;
      stroke-dashoffset: 1600;
      animation: draw 1.85s ease-in-out infinite;
      animation-delay: .12s;
      opacity:.95;
    }
    @keyframes draw{
      0%   { stroke-dashoffset: 1600; opacity:.22; }
      28%  { opacity:1; }
      55%  { stroke-dashoffset: 0; opacity:1; }
      100% { stroke-dashoffset: -1600; opacity:.22; }
    }

    .couple{
      position:relative;
      width:min(520px, 96%);
      height: 270px;
      display:grid;
      place-items:center;
      z-index:2;
      animation: sway 3.1s ease-in-out infinite;
      filter: url(#wobble);
    }
    @keyframes sway{
      0%,100%{ transform: rotate(-1deg) translateY(0); }
      50%{ transform: rotate(1deg) translateY(-3px); }
    }

    .stick{
      position:absolute;
      width: 240px;
      height: 270px;
      display:grid;
      place-items:start center;
      transform-origin:center;
    }
    .stick.left{ left: 2%; }
    .stick.right{ right: 2%; }

    .face{
      width: clamp(68px, 18vw, 104px);
      height: clamp(68px, 18vw, 104px);
      border:none;
      border-radius:0;
      background:transparent;
      box-shadow:none;
      overflow:visible;
      position:relative;
      z-index:5;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.14));
    }
    .face img{
      width:100%;
      height:100%;
      object-fit:contain;
      transform:none;
      display:block;
    }

    .man{
      width: 240px;
      height: 170px;
      margin-top: -6px;
      overflow: visible;
      z-index:2;
    }
    .man path, .man line{
      stroke: rgba(0,0,0,.86);
      stroke-width: 7;
      fill:none;
      stroke-linecap:round;
      stroke-linejoin:round;
    }

    .armL, .armR{ transform-box: fill-box; transform-origin: 50% 10%; }
    .left .armR{ animation: hugArmIn 2.6s ease-in-out infinite; }
    .left .armL{ animation: hugArmOut 2.6s ease-in-out infinite; }
    .right .armL{ animation: hugArmIn 2.6s ease-in-out infinite; }
    .right .armR{ animation: hugArmOut 2.6s ease-in-out infinite; }

    @keyframes hugArmIn{
      0%,100%{ transform: rotate(6deg) translate(0,0); }
      45%{ transform: rotate(-18deg) translate(10px, 6px); }
      60%{ transform: rotate(-26deg) translate(18px, 10px); }
    }
    @keyframes hugArmOut{
      0%,100%{ transform: rotate(-8deg) translate(0,0); opacity:.95; }
      50%{ transform: rotate(10deg) translate(-6px, 4px); opacity:.85; }
    }

    .miniHeart{
      position:absolute;
      left:50%;
      top: 46%;
      transform: translate(-50%,-50%);
      font-size: 26px;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.10));
      animation: pulse 1.6s ease-in-out infinite;
      z-index: 6;
      pointer-events:none;
    }
    @keyframes pulse{
      0%{ transform: translate(-50%,-50%) scale(1); }
      50%{ transform: translate(-50%,-50%) scale(1.2); }
      100%{ transform: translate(-50%,-50%) scale(1); }
    }

    .tip{
      margin-top:10px;
      font-size:13px;
      opacity:.82;
      font-weight:900;
      padding:8px 10px;
      border: 2px solid rgba(0,0,0,.70);
      border-radius:999px;
      background:#fff;
      justify-self:center;
      transform: rotate(.6deg);
      text-align:center;
      display:inline-block;
    }

    .fx{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 0;
    }
    .p{
      position:absolute;
      font-size:18px;
      will-change: transform, opacity;
      animation: fall linear forwards;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.08));
      opacity:.95;
    }
    @keyframes fall{
      0%{ transform: translateY(-40px) rotate(0deg); opacity:0; }
      12%{ opacity:1; }
      100%{ transform: translateY(110vh) rotate(520deg); opacity:0; }
    }

    .toast{
      position:fixed;
      left:50%;
      bottom: max(14px, env(safe-area-inset-bottom));
      transform: translateX(-50%);
      background:#111;
      color:#fff;
      border: 2px solid rgba(255,255,255,.75);
      padding:10px 14px;
      border-radius:999px;
      font-weight:900;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      box-shadow: 0 18px 40px rgba(0,0,0,.25);
      filter: url(#wobble);
      text-align:center;
      z-index:50;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-4px);
    }

    .soundBtn{
      position:fixed;
      right: 12px;
      top: 12px;
      z-index: 80;
      border: 2px solid rgba(0,0,0,.75);
      border-radius:999px;
      padding:10px 12px;
      font-weight:1000;
      background:#fff;
      box-shadow: 0 12px 26px rgba(0,0,0,.12);
      transform: rotate(1deg);
      display:none;
    }
    .soundBtn.show{ display:block; }
  </style>
</head>

<body>
  <svg id="filters" aria-hidden="true">
    <filter id="wobble">
      <feTurbulence type="fractalNoise" baseFrequency="0.012" numOctaves="2" seed="8" />
      <feDisplacementMap in="SourceGraphic" scale="7" />
    </filter>
  </svg>

  <div class="fx" id="fx" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>

  <audio id="bgm" src="song.mp3" preload="auto" loop></audio>
  <button class="soundBtn" id="soundBtn" aria-label="Sound einschalten">üîä Sound</button>

  <div class="wrap">
    <section class="card" id="card" aria-label="Valentinsfrage Paint Style">
      <main>

        <div class="topRow">
          <img class="topGif" src="top.gif" alt="gif" />
        </div>

        <div class="panel">
          <div class="scribble" aria-hidden="true"></div>

          <h1>Valentinsdate? üíò</h1>
          <p class="sub">werden wir gl√ºcklich?.</p>

          <p class="copy">
            Hi Carla ‚Äî kurze, sehr seri√∂se Frage:
            <br><b>Hast du Lust auf ein Date?</b>
          </p>

          <div class="btns" id="btns">
            <button class="yes" id="yesBtn">JA üòé‚ú®</button>
            <button class="maybe" id="maybeBtn">Vielleicht ü§î</button>
            <button class="no" id="noBtn">
              Nein (ich bin stark)
              <span class="legs" aria-hidden="true">
                <span class="leg l1"></span>
                <span class="leg l2"></span>
              </span>
            </button>
          </div>

          <div class="result" id="resultMaybe">
            <h2>üëÄ vielleicht ist auch ein ja</h2>
            <p>Was w√§re dein ‚ÄúVielleicht‚Äù-Gedanke?</p>
            <div class="inputRow show" id="maybeRow">
              <input id="maybeInput" type="text" placeholder="z.B. wann / was / warum üëÄ" maxlength="90" />
              <button class="saveBtn" id="saveMaybe">senden ‚úÖ</button>
            </div>
            <div class="picked" id="maybeSaved"></div>
          </div>

          <div class="result" id="resultYes">
            <h2>juhu ü§ùüíû</h2>
            <p>W√§hle Aktivit√§t an Gemeinsamkeit:</p>
            <div class="choices" id="choices">
              <button class="chipBtn" data-choice="üç∞ Kuchen essen">üç∞ Kuchen essen</button>
              <button class="chipBtn" data-choice="ü•æ Wandern">ü•æ Wandern</button>
              <button class="chipBtn" data-choice="üçΩÔ∏è Essen gehen">üçΩÔ∏è Essen gehen</button>
              <button class="chipBtn" data-choice="üì∫ Netflix">üì∫ Netflix</button>
              <button class="chipBtn" data-choice="‚ú® Dein Vorschlag">‚ú® Dein Vorschlag</button>
            </div>

            <div class="inputRow" id="proposalRow">
              <input id="proposalInput" type="text" placeholder="dein vorschlag" maxlength="90" />
              <button class="saveBtn" id="saveProposal">speichern ‚úÖ</button>
            </div>

            <div class="picked" id="picked"></div>
          </div>

          <div class="result" id="resultNo">
            <h2>üòî Okay‚Ä¶</h2>
            <p>Trag hier deine Ausrede ein:</p>
            <div class="inputRow show" id="inputRow">
              <input id="excuseInput" type="text" placeholder="meine peinliche ausrede" maxlength="90" />
              <button class="saveBtn" id="saveExcuse">absenden ‚úçÔ∏è</button>
            </div>
            <div class="picked" id="excuseSaved"></div>
          </div>
        </div>

        <aside class="stage">
          <div class="faces" id="faces">

            <div class="heartLink" aria-hidden="true">
              <svg class="heartSvg" viewBox="0 0 600 520">
                <path class="strokeA" d="M300 470
                  C210 430, 90 350, 120 230
                  C140 140, 240 120, 300 190
                  C360 120, 460 140, 480 230
                  C510 350, 390 430, 300 470" />
                <path class="strokeB" d="M300 470
                  C210 430, 90 350, 120 230
                  C140 140, 240 120, 300 190
                  C360 120, 460 140, 480 230
                  C510 350, 390 430, 300 470" />
              </svg>
            </div>

            <div class="couple" id="couple">
              <div class="miniHeart" aria-hidden="true">üíñ</div>

              <div class="stick left" id="stickJanek">
                <div class="face" id="faceJanek"><img id="imgJanek" src="janek kopf.png" alt="Janek" /></div>
                <svg class="man" viewBox="0 0 240 170" aria-hidden="true">
                  <line x1="120" y1="12" x2="120" y2="98"></line>
                  <line x1="120" y1="98" x2="92" y2="152"></line>
                  <line x1="120" y1="98" x2="148" y2="152"></line>
                  <g class="armL"><path d="M120 44 Q 92 58 70 82"></path></g>
                  <g class="armR"><path d="M120 44 Q 168 62 206 92"></path></g>
                </svg>
              </div>

              <div class="stick right" id="stickCarla">
                <div class="face" id="faceCarla"><img id="imgCarla" src="carla kopf.png" alt="Carla" /></div>
                <svg class="man" viewBox="0 0 240 170" aria-hidden="true">
                  <line x1="120" y1="12" x2="120" y2="98"></line>
                  <line x1="120" y1="98" x2="92" y2="152"></line>
                  <line x1="120" y1="98" x2="148" y2="152"></line>
                  <g class="armL"><path d="M120 44 Q 70 62 34 92"></path></g>
                  <g class="armR"><path d="M120 44 Q 150 58 174 82"></path></g>
                </svg>
              </div>
            </div>

          </div>

          <div class="tip">Tipp: Versuch nicht ‚ÄúNein‚Äù zu klicken</div>
        </aside>

      </main>
    </section>
  </div>

  <div class="toast" id="toast">üß† Tipp: Nicht ‚ÄúNein‚Äù klicken. Wirklich nicht.</div>

  <!-- ‚úÖ Supabase FIRST (module) -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    // TODO: set these
    const SUPABASE_URL = "https://ohydofayfztvfaajhftb.supabase.co";
    const SUPABASE_KEY = "sb_publishable_y6qJgEkO9k8rvb98BLq1WA_7R8Z_NH1";

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const SESSION_KEY = "val_session_id";
    const session_id = localStorage.getItem(SESSION_KEY) || crypto.randomUUID();
    localStorage.setItem(SESSION_KEY, session_id);

    async function saveResponse(kind, value){
      try{
        const payload = {
          kind,
          value: String(value).slice(0, 200),
          page: location.href,
          user_agent: navigator.userAgent,
          session_id
        };
        const { error } = await supabase.from("responses").insert(payload);
        if(error) console.warn("Supabase insert error:", error);
      }catch(e){
        console.warn("Supabase save failed:", e);
      }
    }

    window.saveResponse = saveResponse;
  </script>

  <!-- ‚úÖ App logic -->
  <script>
    const yesBtn = document.getElementById("yesBtn");
    const maybeBtn = document.getElementById("maybeBtn");
    const noBtn  = document.getElementById("noBtn");

    const resultYes = document.getElementById("resultYes");
    const resultNo  = document.getElementById("resultNo");
    const resultMaybe = document.getElementById("resultMaybe");

    const picked = document.getElementById("picked");
    const choices = document.getElementById("choices");

    const inputRow = document.getElementById("inputRow");
    const excuseInput = document.getElementById("excuseInput");
    const saveExcuse = document.getElementById("saveExcuse");
    const excuseSaved = document.getElementById("excuseSaved");

    const proposalRow = document.getElementById("proposalRow");
    const proposalInput = document.getElementById("proposalInput");
    const saveProposal = document.getElementById("saveProposal");

    const maybeInput = document.getElementById("maybeInput");
    const saveMaybe = document.getElementById("saveMaybe");
    const maybeSaved = document.getElementById("maybeSaved");

    const toast  = document.getElementById("toast");
    const fx     = document.getElementById("fx");
    const card   = document.getElementById("card");

    const faceJanek = document.getElementById("faceJanek");
    const faceCarla = document.getElementById("faceCarla");

    const bgm = document.getElementById("bgm");
    const soundBtn = document.getElementById("soundBtn");
    let soundOn = false;

    const rand = (min,max)=> Math.random()*(max-min)+min;

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.classList.remove("show"), 2400);
    }

    function popFX(count=32){
      const items = ["üíñ","üíò","‚ú®","ü´∂","üå∏","üçì","‚≠êÔ∏è","üí•","üñçÔ∏è"];
      for(let i=0;i<count;i++){
        const e = document.createElement("div");
        e.className = "p";
        e.textContent = items[(Math.random()*items.length)|0];
        e.style.left = rand(0,100) + "vw";
        e.style.top  = rand(-18,-6) + "vh";
        e.style.fontSize = rand(14,28) + "px";
        e.style.animationDuration = rand(2.6,5.0) + "s";
        e.style.animationDelay = rand(0,0.25) + "s";
        fx.appendChild(e);
        e.addEventListener("animationend", ()=> e.remove());
      }
    }

    function boopFaces(){
      if(!faceJanek || !faceCarla) return;
      faceJanek.classList.remove("boop");
      faceCarla.classList.remove("boop");
      void faceJanek.offsetWidth;
      faceJanek.classList.add("boop");
      faceCarla.classList.add("boop");
    }

    async function tryStartMusic(){
      if(soundOn) return true;
      try{
        bgm.volume = 0.55;
        await bgm.play();
        soundOn = true;
        soundBtn.classList.remove("show");
        return true;
      }catch(e){
        soundBtn.classList.add("show");
        return false;
      }
    }
    soundBtn.addEventListener("click", async ()=>{
      await tryStartMusic();
      showToast("üîä ok");
    });
    window.addEventListener("pointerdown", ()=>{ tryStartMusic(); }, { once:true });

    function hideAllResults(){
      resultYes.classList.remove("show");
      resultNo.classList.remove("show");
      resultMaybe.classList.remove("show");
    }

    // random nudge for NO button
    let noNudgeTimer = null;
    let noOffset = {x:0, y:0};

    function nudgeNo(){
      if(noBtn.classList.contains("runner")) return;
      const dx = rand(-10, 10);
      const dy = rand(-6, 6);

      noOffset.x = Math.max(-18, Math.min(18, noOffset.x + dx));
      noOffset.y = Math.max(-10, Math.min(10, noOffset.y + dy));

      noBtn.style.transform = `translate(${noOffset.x}px, ${noOffset.y}px) rotate(${rand(-1.2,1.2)}deg)`;
      clearTimeout(noNudgeTimer);
      noNudgeTimer = setTimeout(nudgeNo, rand(450, 1200));
    }
    nudgeNo();

    // YES
    function doYes(){
      tryStartMusic();
      hideAllResults();
      resultYes.classList.add("show");
      picked.classList.remove("show");
      proposalRow.classList.remove("show");
      popFX(70);
      boopFaces();

      yesBtn.disabled = true;
      maybeBtn.disabled = true;
      noBtn.disabled = true;

      showToast("‚úÖ Ja registriert. Jetzt wird geplant.");
      if (window.saveResponse) window.saveResponse("yes", "JA");
    }
    yesBtn.addEventListener("click", doYes);

    // MAYBE
    function doMaybe(){
      tryStartMusic();
      hideAllResults();
      resultMaybe.classList.add("show");
      maybeSaved.classList.remove("show");
      maybeSaved.textContent = "";
      popFX(22);
      boop
